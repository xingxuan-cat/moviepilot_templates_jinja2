# ðŸ“˜ æ­¤æ–‡æ¡£ä¸ºé¡¹ç›®ä¸­ç”¨åˆ°çš„æ¨¡å—


> [!NOTE] æ³¨é‡Š
> ç›®å‰MPå†…ä¸æ”¯æŒå¤šè¡Œæ¨¡æ¿ æœ€ç»ˆè¾“å‡ºéœ€è¦ä½¿ç”¨å•è¡Œæ¨¡æ¿

---

## ðŸ§© æ¨¡å—ä¾èµ–

```jinja2
{% set onl = original_name | lower %} {# å°å†™åŽŸæ–‡ä»¶å #}
{% set rgl = releaseGroup | lower %} {# å°å†™å‘è¡Œç»„å #}
{% set ns = namespace(
  WebRip='',
  audio=[],
  matched=false,
  dr='SDR',
  extra_list=[],
  channel='',
) %}
```

---

## ðŸ—‚ï¸ MP å®˜æ–¹å¯ä½¿ç”¨çš„å¤–éƒ¨å˜é‡

```jinja2
title : TMDB/è±†ç“£ä¸­çš„ä¸­æ–‡æ ‡é¢˜
en_title : TMDBä¸­çš„è‹±æ–‡æ ‡é¢˜ (ä¸æ”¯æŒè±†ç“£)
original_title : TMDB/è±†ç“£ä¸­çš„åŽŸè¯­ç§æ ‡é¢˜
name : ä»Žæ–‡ä»¶åä¸­è¯†åˆ«çš„åç§° (åŒæ—¶å­˜åœ¨ä¸­è‹±æ–‡æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ä¸­æ–‡)
en_name : ä»Žæ–‡ä»¶åä¸­è¯†åˆ«çš„è‹±æ–‡åç§° (å¯èƒ½ä¸ºç©º)
year : å¹´ä»½
resourceType : èµ„æºç±»åž‹
effect : ç‰¹æ•ˆ
edition : ç‰ˆæœ¬
videoFormat : åˆ†è¾¨çŽ‡
releaseGroup : å‘è¡Œç»„
videoCodec : è§†é¢‘ç¼–ç 
audioCodec : éŸ³é¢‘ç¼–ç 
tmdbid : TMDB ID
imdbid : IMDB ID
doubanid : è±†ç“£ID
part : æ®µ/èŠ‚/éƒ¨åˆ†
fileExt : æ–‡ä»¶æ‰©å±•å (åŒ…æ‹¬.)
customization : è‡ªå®šä¹‰å ä½ç¬¦ [åœ¨è‡ªå®šä¹‰è§„åˆ™ä¸­ä¸éœ€è¦ä½¿ç”¨]
webSource : æµåª’ä½“å¹³å°

# ä»¥ä¸‹æ˜¯ç”µè§†å‰§ä¸“å±žçš„ #
season : å­£
season_year : å­£çš„å¹´ä»½
episode : é›†
season_episode : å­£é›† (SxxExx)
episode_title : é›†æ ‡é¢˜
episode_date : é›†é¦–æ’­æ—¥æœŸ
```

---

## ðŸŒˆ æå–è‰²å½©æ·±åº¦ (`bit_depth`)

```jinja2
{% set bit_depth_list = ['8bit','10bit','12bit'] %}
{% set bit_depth = (bit_depth_list | select('in', onl) | list | last) or '' %}
```

---

## ðŸ’¿ ç‰‡æºç‰ˆæœ¬ (`edition_mod`)

```jinja2
{% set edition_mod_bd = ['vcb-studio','moozzi2','mai','ye','mawen1250','acgnation','mysilu'] %} {# å®šä¹‰ BluRay-Rip çš„å¸¸è§å‘è¡Œç»„ #}
{% set edition_mod_web = ['lolihouse','sakurato','dynamis one','ani'] %} {# å®šä¹‰ Web-Rip çš„å¸¸è§å‘è¡Œç»„ #}

{# æ ¹æ®å­—å¹•ç»„æ›¿æ¢ç‰‡æºç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§BluRay-Remux > BluRay-Rip > Web-Ripï¼‰#}
{% set edition_mod = 
    'BluRay-Remux' if 'bdremux' in onl 
    else 'BluRay-Rip' if edition_mod_bd | select('in', rgl) | list | length > 0 
    else 'Web-Rip' if edition_mod_web | select('in', rgl) | list | length > 0 and not resourceType 
    else resourceType 
%}
```

---

## ðŸŒ å‘è¡Œå¹³å° (`WebRip`)

```jinja2
{# æå–Webå‘è¡Œå¹³å° #} {# æ­£å¸¸ #}

{# å®šä¹‰Webå‘è¡Œå¹³å°åˆ«åå¯¹ç…§è¯å…¸ #} {# å¾…ä¼˜åŒ– #}
{% set WebRip_dict = {
  'CR': ['cr', 'crunchyroll'],
  'Baha': ['baha', 'bahamut'],
  'BiliBili-Global': ['b-global'],
  'BiliBili': ['bilibili'],
  'ABEMA': ['abema'],
  'Netflix': ['netflix', 'nfx','nf'],
  'AmazonPrime': ['prime', 'amazonprime', 'amzn'],
  'Hulu': ['hulu'],
  'DisneyPlus': ['disneyplus', 'disney+', 'disney_plus'],
  'HBO': ['hbo', 'hbo max', 'hbomax'],
  'YouTubePremium': ['youtube', 'ytpremium', 'ytp'],
  'AppleTV': ['appletv', 'apple tv', 'apple_tv','atvp'],
  'Crunchyroll': ['crunchyroll', 'crunchy'],
  'Funimation': ['funimation', 'funi'],
  'Vimeo': ['vimeo'],
  'Peacock': ['peacock'],
  'ParamountPlus': ['paramount+', 'paramountplus', 'paramount_plus'],
  'DAZN': ['dazn'],
  'Tubi': ['tubi'],
  'RakutenTV': ['rakuten', 'rakutentv'],
  'Tencent Video': ['tencent', 'tencentvideo'],
  'iQIYI': ['iqiyi', 'çˆ±å¥‡è‰º', 'iqy'],
  'Youku': ['youku', 'ä¼˜é…·'],
  'MangoTV': ['mangotv', 'èŠ’æžœtv', 'mgtv'],
} %}

{# æå–Webå‘è¡Œå¹³å° #} {# éœ€è¦ ns.WebRip #}
{% for platform, aliases in WebRip_dict.items() %}
  {% if ns.WebRip == '' %}
    {% for alias in aliases %}
      {% if alias | lower in onl %}
        {% set ns.WebRip = platform %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

```

---

## ðŸ”Š æå–éŸ³é¢‘ç¼–ç  (`audio_mod`)

```jinja2
{# æå–éŸ³é¢‘ç¼–ç  #} {# æ­£å¸¸ #} {# éœ€è¦ ns.audio #}

{# å®šä¹‰éŸ³é¢‘ç¼–ç åˆ«åå¯¹ç…§è¯å…¸ #}
{% set audio_dict = {
  'PCM': ['pcm'],
  'TrueHD': ['truehd'],
  'DTS-HD MA': ['dts-hd ma','dts-hd.ma','dts-hd_ma','dts-hd.master'],
  'DTS-HD': ['dts-hd','dts hd'],
  'DTS': ['dts','dts5.1'],
  'FLAC': ['flac'],
  'OPUS': ['opus'],
  'DDP': ['ddp','eac3','dd+'],
  'DD': ['dd','ac3','ac-3'],
  'AAC': ['aac']
} %}

{% set standard_audio_list = ['PCM','TrueHD','DTS-HD MA','DTS-HD','DTS','FLAC','OPUS','DDP','DD','AAC'] %} {# å®šä¹‰åŒ¹é…ä¼˜å…ˆçº§é¡ºåº (ä»Žé«˜åˆ°ä½Ž)#} {# ä¾‹:FLAC&AAC #}

{# æå–éŸ³é¢‘ç¼–ç  #}
{% for x in standard_audio_list %}
  {% set ns.matched = false %}
  {% for alias in audio_dict[x] %}
    {% if not ns.matched and alias in onl %}
      {% set ns.audio = ns.audio + [x] %}
      {% set ns.matched = true %}
    {% endif %}
  {% endfor %}
{% endfor %}

{# DTSåŽ»é‡ #} {# æœªå¯¹ DTS,DTS-HD,DTS-HD MA åŒæ—¶å­˜åœ¨çš„æƒ…å†µåšé€‚é… #}
{% if 'DTS-HD MA' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DTS-HD') | reject('equalto', 'DTS') | list %}
{% elif 'DTS-HD' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DTS') | list %}
{% endif %}

{# DDåŽ»é‡ #} {# æœªå¯¹ DD,DDP (AC3,EAC3) åŒæ—¶å­˜åœ¨çš„æƒ…å†µåšé€‚é… #}
{% if 'DDP' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DD') | list %}
{% endif %}

{# è¾“å‡ºæ¨¡å— #}
{% if ns.audio %}
  {% set audio_mod = ns.audio | join('&') %}
{% elif audioCodec %}
  {% set audio_mod = audioCodec %}
{% endif %}
```

---

## ðŸ”ˆ æå–éŸ³é¢‘å‚æ•°åŒ…å«å£°é“æ•°å’ŒAtmos (`audio_mod`)

```jinja2
{# æå–éŸ³é¢‘å‚æ•° (åŒ…å«å£°é“æ•°ä¸ŽAtmos) #} {# æ­£å¸¸ #} {# éœ€è¦ ns.audio AND ns.channel #}

{# å®šä¹‰éŸ³é¢‘ç¼–ç åˆ«åå¯¹ç…§è¯å…¸ #}
{% set audio_dict = {
  'PCM': ['pcm'],
  'TrueHD': ['truehd'],
  'DTS-HD MA': ['dts-hd ma','dts-hd.ma','dts-hd_ma','dts-hd.master'],
  'DTS-HD': ['dts-hd','dts hd'],
  'DTS': ['dts','dts5.1'],
  'FLAC': ['flac'],
  'OPUS': ['opus'],
  'DDP': ['ddp','eac3','dd+'],
  'DD': ['dd','ac3','ac-3'],
  'AAC': ['aac']
} %}

{# ä½¿ç”¨æ—¶äºŒé€‰ä¸€#}
{% set standard_audio_list = ['AAC','DD','DDP','FLAC','OPUS','DTS','DTS-HD','DTS-HD MA','TrueHD','PCM'] %} {# å®šä¹‰åŒ¹é…ä¼˜å…ˆçº§é¡ºåº (ä»Žä½Žåˆ°é«˜)#} {# ä¾‹:AAC&FLAC #}
{% set standard_audio_list = ['PCM','TrueHD','DTS-HD MA','DTS-HD','DTS','FLAC','OPUS','DDP','DD','AAC'] %} {# å®šä¹‰åŒ¹é…ä¼˜å…ˆçº§é¡ºåº (ä»Žé«˜åˆ°ä½Ž)#} {# ä¾‹:FLAC&AAC #}

{# æå–éŸ³é¢‘ç¼–ç  #}
{% for x in standard_audio_list %}
  {% set ns.matched = false %}
  {% for alias in audio_dict[x] %}
    {% if not ns.matched and alias in onl %}
      {% set ns.audio = ns.audio + [x] %}
      {% set ns.matched = true %}
    {% endif %}
  {% endfor %}
{% endfor %}

{# DTSåŽ»é‡ #} {# æœªå¯¹ DTS,DTS-HD,DTS-HD MA åŒæ—¶å­˜åœ¨çš„æƒ…å†µåšé€‚é… #}
{% if 'DTS-HD MA' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DTS-HD') | reject('equalto', 'DTS') | list %}
{% elif 'DTS-HD' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DTS') | list %}
{% endif %}

{# DDåŽ»é‡ #} {# æœªå¯¹ DD,DDP (AC3,EAC3) åŒæ—¶å­˜åœ¨çš„æƒ…å†µåšé€‚é… #}
{% if 'DDP' in ns.audio %}
  {% set ns.audio = ns.audio | reject('equalto', 'DD') | list %}
{% endif %}

{# ç‰¹ä¾‹ #}
{% if '5.1.2audio' in onl %}
  {% set ns.channel = '5.1ch' %}
{% endif %}

{# æå–å£°é“æ•° #}
{% for x in ['7.1.4','7.1.2','7.1','5.1.4','5.1.2','5.1','2.0'] %}
  {% if ns.channel == '' and ('.' ~ x in onl or x in onl) %}
    {% set ns.channel = x ~ 'ch' %}
  {% endif %}
{% endfor %}

{# æå–Atmosæ ‡è®° #}

{% set atmos = 'Atmos' if 'atmos' in onl else '' %}

{# æ‹¼æŽ¥å®Œæ•´å‚æ•° #}
{% set audio_mod = ns.audio | join('&') %}
{% if audio_mod and ns.channel %}
  {% set audio_mod = audio_mod ~ '_' ~ ns.channel %}
  {% if audio_mod and atmos %}
    {% set audio_mod = audio_mod ~ '.' ~ atmos %}
    {% endif %}
{% endif %}
{% if not audio_mod %}
  {% set audio_mod = audioCodec %}
{% endif %}
```

---

## ðŸŒ„ æå–åŠ¨æ€èŒƒå›´ (`dr`)

```jinja2
{# æå–åŠ¨æ€èŒƒå›´ #} {# æ­£å¸¸ #} {# éœ€è¦ ns.dr #}

{# Dolby Vision Profile åˆ«åå­—å…¸ #}
{% set dv_dict = {
  'DolbyVision_Profile8.1': ['p8.1'],
  'DolbyVision_Profile8': ['p8'],
  'DolbyVision_Profile7': ['p7'],
  'DolbyVision_Profile5': ['p5'],
  'DolbyVision': ['dv', 'dovi', 'dolbyvision', 'dolby.vision', 'dolby_vision']
} %}

{# HDR Profile åˆ«åå­—å…¸ #}
{% set hdr_dict = {
  'HDR_HDR10+': ['hdr10+', 'hdr10plus', 'hdr10_plus'],
  'HDR_HDR10': ['hdr10'],
  'HDR_HLG': ['hlg'],
  'HDR': ['hdr']
} %}

{% set tokens = onl.replace('.', ' ').replace('_', ' ').replace('-', ' ').split() %}

{# åŒ¹é… DolbyVision #}
{% for profile, aliases in dv_dict.items() %}
  {% for alias in aliases %}
    {% if ns.dr == 'SDR' and alias in tokens %}
      {% set ns.dr = profile %}
    {% endif %}
  {% endfor %}
{% endfor %}

{# åŒ¹é… HDR #}
{% if ns.dr == 'SDR' %}
  {% for profile, aliases in hdr_dict.items() %}
    {% for alias in aliases %}
      {% if ns.dr == 'SDR' and alias in tokens %}
        {% set ns.dr = profile %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endif %}
```

---

## ðŸ§¾ æå–é¢å¤–å‚æ•° (`extra`)

```jinja2
{# æå–é¢å¤–å‚æ•° #} {# æ­£å¸¸ #}

{# æå–é¢å¤–å‚æ•° #}
{% for t in ['3d','imax','60fps','120fps'] %} {# è‡ªå®šä¹‰é¢å¤–å‚æ•°æ·»åŠ åˆ°åˆ—è¡¨ä¸­ #}
  {% if t in onl %}
    {% set upper = t | upper %}
    {% if upper not in ns.extra_list %}
      {% set ns.extra_list = ns.extra_list + [upper] %}
    {% endif %}
  {% endif %}
{% endfor %}

{# èµ‹å€¼æå–åˆ°çš„é¢å¤–å‚æ•° #}
{% set extra = ns.extra_list | join(' ') %}
```

---

## ðŸ§± æ‹¼æŽ¥æœ€ç»ˆè¾“å‡º (`out`)

```jinja2
{# æ‹¼æŽ¥è¾“å‡ºå‚æ•° #} {# éœ€è¦è‡ªè¡Œæ›´æ”¹ #}

{% set out = videoFormat | upper %} {# åˆ†è¾¨çŽ‡ #}

{% if edition_mod is defined or resourceType is defined %} {# ç‰‡æºç‰ˆæœ¬ #}
  {% set out = out ~ ' ' ~ (edition_mod if edition_mod is defined else resourceType) %}
  {% if ns.WebRip is defined %} 
    {% set out = out ~ '.' ~ ns.WebRip %} {# å‘è¡Œå¹³å° #}
  {% endif %}
{% endif %}

{% if videoCodec is defined %} {# è§†é¢‘ç¼–ç  #}
  {% set out = out ~ ' ' ~ videoCodec %}
  {% if bit_depth is defined %}
    {% set out = out ~ '_' ~ bit_depth %} {# è‰²å½©æ·±åº¦ #}
  {% endif %}
{% endif %}

{% if audio_mod is defined %}{% set out = out ~ ' ' ~ audio_mod %}{% endif %} {# éŸ³é¢‘å‚æ•° #}
{% if ns.dr is defined %}{% set out = out ~ ' ' ~ ns.dr %}{% endif %} {# åŠ¨æ€èŒƒå›´ #}
{% if extra is defined %}{% set out = out ~ ' ' ~ extra %}{% endif %} {# é¢å¤–å‚æ•° #}
```

---

## ðŸŽ¬ æ–‡ä»¶å‘½åè¾“å‡ºè§„åˆ™

### ðŸ“º ç”µè§†å‰§

```jinja2
{# æ ¹æ®æ–‡ä»¶æ€»é•¿åº¦åˆ¤æ–­æ€»å‘½åé˜²æ­¢æ–‡ä»¶è·¯å¾„è¿‡é•¿ #} {# ç”µè§†å‰§ #} {# è‡ªè¡Œæ›¿æ¢éœ€è¦çš„æ ¼å¼ #}
{% set full_name = title ~ " _ " ~ en_title ~ " _ " ~ original_title ~ " (" ~ year ~ ")" ~ "/Season " ~ season ~ "/" ~ title ~ " - " ~ season_episode ~ " - " ~ out ~ ((" - " ~ releaseGroup) if releaseGroup else "") ~ fileExt %}

{% if full_name | length > 220 %}
  {{ title }} ("{{ year }}")/Season {{ season }}/{{ title }} - {{ season_episode }} - {{ out }}{% if releaseGroup %} - {{ releaseGroup }}{% endif %}{{ fileExt }}
{% else %}
  {{ full_name }}
{% endif %}
```

### ðŸŽ¥ ç”µå½±

```jinja2
{# ç”µå½± #} {# è‡ªè¡Œæ›¿æ¢éœ€è¦çš„æ ¼å¼ #}
{% set full_name = title ~ " _ " ~  original_title ~ " (" ~ year ~ ")" ~ "/" ~ title ~ " - " ~ out ~ ((" - " ~ releaseGroup) if releaseGroup else "") ~ fileExt %}

{% if full_name | length > 180 %}
  {{ title }} ({{ year }})/{{ title }} - {{ out }}{% if releaseGroup %} - {{ releaseGroup }}{% endif %}{{ fileExt }}
{% else %}
  {{ full_name }}
{% endif %}
```

---

[^1]: 
