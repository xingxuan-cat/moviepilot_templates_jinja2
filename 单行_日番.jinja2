{% set rgl=releaseGroup|lower %}{% set onl=original_name|lower %}{% set ns=namespace(audio=[],webrip='',matched='') %}{% set edition_mod_bd=['vcb-studio','moozzi2','mai','ye','mawen1250','acgnation'] %}{% set edition_mod_web=['lolihouse'] %}{% set edition_mod='BluRay-Remux' if 'bdremux' in onl else 'BluRay-Rip' if edition_mod_bd|select('in',rgl)|list|length>0 else 'Web-Rip' if edition_mod_web|select('in',rgl)|list|length>0 and not edition else edition %}{% set WebRip_dict={'CR':['cr','crystal'],'Baha':['baha','bahamut'],'BiliBili-Global':['B-Global'],'BiliBili':['bilibili'],'ABEMA':['abema']} %}{% for x,aliases in WebRip_dict.items() %}{% if ns.webrip=='' %}{% for alias in aliases %}{% if alias in onl %}{% set ns.webrip=x %}{% endif %}{% endfor %}{% endif %}{% endfor %}{% set bitdepth_list=['8bit','10bit','12bit'] %}{% set audio_bd=[] %}{% for b in bitdepth_list %}{% if b in onl %}{% set _=audio_bd.append(b) %}{% endif %}{% endfor %}{% set bitdepth_mod=audio_bd|last if audio_bd else '' %}{% set audio_dict={'PCM':['pcm'],'TrueHD':['truehd'],'DTS-HD MA':['dts-hd ma','dts-hd.ma','dts-hd_ma','dts-hd.master'],'DTS-HD':['dts-hd','dts hd','dts hd'],'DTS':['dts','dts5.1'],'FLAC':['flac'],'OPUS':['opus'],'DDP':['ddp','eac3','dd+'],'DD':['dd','ac3','ac-3'],'AAC':['aac']} %}{% set standard_audio_list=['AAC','DD','DDP','FLAC','OPUS','DTS','DTS-HD','DTS-HD MA','TrueHD','PCM'] %}{% for x in standard_audio_list %}{% set ns.matched=false %}{% for alias in audio_dict[x] %}{% if not ns.matched and alias in onl %}{% set ns.audio=ns.audio+[x] %}{% set ns.matched=true %}{% endif %}{% endfor %}{% endfor %}{% if 'DTS-HD MA' in ns.audio %}{% set ns.audio=ns.audio|reject('equalto','DTS-HD')|reject('equalto','DTS')|list %}{% elif 'DTS-HD' in ns.audio %}{% set ns.audio=ns.audio|reject('equalto','DTS')|list %}{% endif %}{% if 'DDP' in ns.audio %}{% set ns.audio=ns.audio|reject('equalto','DD')|list %}{% endif %}{% set audio_mod=ns.audio|join('&') %}{% set out=videoFormat|upper %}{% if edition_mod %}{% set out=out~' '~edition_mod %}{% endif %}{% if ns.webrip %}{% set out=out~'.'~ns.webrip %}{% endif %}{% if videoCodec %}{% set out=out~' '~videoCodec %}{% if bitdepth_mod %}{% set out=out~'_'~bitdepth_mod %}{% endif %}{% elif bitdepth_mod %}{% set out=out~' '~bitdepth_mod %}{% endif %}{% if audio_mod %}{% set out=out~' '~audio_mod %}{% endif %}{{ title }} _ {{ en_title }} _ {{ original_title }} ({{ year }})/Season {{ season }}/{{ title }} - {{ season_episode }} - {{ out }}{% if releaseGroup %} - {{ releaseGroup }}{% endif %}{{ fileExt }}